stages:
  - build

variables:
  APPIMAGE_NAME: Installer_GUI-x86_64.AppImage
  PYTHON_VERSION: "3.9"

build_linux_appimage:
  stage: build
  image: python:${PYTHON_VERSION}-buster
  before_script:
    # Install dependencies
    - apt-get update && apt-get install -y fuse libfuse2
    - pip install pyinstaller
    - wget https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-x86_64.AppImage
    - chmod +x appimagetool-x86_64.AppImage
  script:
    # Prepare AppDir structure
    - mkdir -p AppDir/usr/bin AppDir/usr/share/applications AppDir/usr/share/icons/hicolor/256x256/apps
    
    # Build the application
    - pyinstaller --onefile --windowed installer_gui.py
    - mv dist/installer_gui AppDir/usr/bin/
    
    # Create desktop entry file
    - |
      cat << EOF > AppDir/usr/share/applications/installer_gui.desktop
      [Desktop Entry]
      Name=Installer GUI
      Exec=installer_gui
      Icon=installer_gui
      Type=Application
      Categories=Utility;
      EOF
    
    # Create AppImage
    - ./appimagetool-x86_64.AppImage AppDir
  artifacts:
    paths:
      - ${APPIMAGE_NAME}